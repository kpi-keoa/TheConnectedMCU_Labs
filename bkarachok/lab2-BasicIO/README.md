In this laboratory work, a tug-of-war game was developed, the rope position is indicated by one of the four LEDs. Original state - 2 LEDs in center turned on. Each press of BTN1 moves the virtual rope one step to the left, each press of BTN2 moves it one step to the right. The game ends if the rope is pulled far enough from the central starting position.
To indicate the position of the rope, the general variable G_Position is used. It is initialized to 0. By pressing BTN1, the G_Position variable is decremented by 1. Pressing BTN2 increases G_Position by 1. If the position of the virtual rope becomes <= -4 - the left side wins and if >= 4, the right side wins. If the right side wins, then the mode for the LEDs is executed - the running line from the left to the right, if the left side wins, then the right side to the left. Then the LEDs return to the initial state.
The standard interrupt handling function was modified by adding a new mode when both buttons are pressed. In this case, counting and comparing the number of wins of both sides are performed. If the right has won more times than the left, then the mode of the running line of the LEDs from the left to the right is called, if the left has won more, then the running line will move from the right to the left, but if the number of wins is equal, the LEDs return to their original state. After each check, the counters are reset to zero (the number of wins on both sides is 0).